;SMAINK7_MPF
DEF STRING [2] DEUR
DEF STRING [2] VERS
DEF STRING [2] DR    ;Draairichting
DEF STRING [2] ANSCH
DEF STRING [4] HARDH ;Hardhout
DEF REAL GRAD        ;Graden
DEF REAL SKS         ;Slotzijde correctie Z axe
DEF REAL ARRAYKRSL[8,9]
DEF REAL ARRAYVG[8,9]
DEF STRING [15] STURING
DEF REAL BRANDWEREND
DEF REAL VOLGENDE_DEURBREEDTE

DEF REAL SB_1_POS
DEF REAL SB_2_POS
DEF REAL SB_3_POS
DEF REAL SB_4_POS
DEF STRING [15] SB_1_PRG
DEF STRING [15] SB_2_PRG
DEF STRING [15] SB_3_PRG
DEF STRING [15] SB_4_PRG
DEF STRING [10] SB_1_VNK
DEF STRING [10] SB_2_VNK
DEF STRING [10] SB_3_VNK
DEF STRING [10] SB_4_VNK
DEF STRING [15] SB_1_TEK
DEF STRING [15] SB_2_TEK
DEF STRING [15] SB_3_TEK
DEF STRING [15] SB_4_TEK

DEF REAL AANSLAG900_L
DEF REAL AANSLAG900_R
DEF INT AANTAL
DEF REAL CORR_AANSLAG900
DEF REAL X_CORR_L
DEF REAL X_CORR_R

EXTERN DBK67(STRING[15], VAR REAL[,9], VAR REAL[,9])
EXTERN KAN7LS1(VAR REAL[,9], VAR REAL[,9], STRING[10])
EXTERN KAN7RS1(VAR REAL[,9], VAR REAL[,9], STRING[10])

AANSLAG900_L = FPAR2_R
AANSLAG900_R = FPAR3_R

X_CORR_L = 0 + KANAAL7_L_XCOR            ; Positief = met as mee
X_CORR_R = 0 + KORA2_S1 + KANAAL7_R_XCOR ; Negatief = tegen as in

IF KANAAL7_FINISHED == 1 GOTOF KANAALOVERSLAAN

;************************************
;Programm um den GUD-Block PRG.X
;in die aktuellen Variablen zu laden
;************************************
IF R0 == 0
   MSG ("R-Parameter im Kanal = 0  !!!!")
   M0
   M30
ENDIF
;******************************
IF R0 == 1 ;GUD큦 Block 1
   DEUR=TEIL_1
   VERS=VERS_1
   DR=LAGE_1
   ANSCH=ANSCH_1
   HARDH=HARTHO_1
   GRAD=GRAD_1
   SKS=SKS_1
   STURING=STURING_1
   BRANDWEREND=BRANDWEREND_1
   SB_1_POS=SB_11_POS
   SB_1_PRG=SB_11_PRG
   SB_1_VNK=SB_11_VNK
   SB_1_TEK=SB_11_TEK
   SB_2_POS=SB_12_POS
   SB_2_PRG=SB_12_PRG
   SB_2_VNK=SB_12_VNK
   SB_2_TEK=SB_12_TEK
   SB_3_POS=SB_13_POS
   SB_3_PRG=SB_13_PRG
   SB_3_VNK=SB_13_VNK
   SB_3_TEK=SB_13_TEK
   SB_4_POS=SB_14_POS
   SB_4_PRG=SB_14_PRG
   SB_4_VNK=SB_14_VNK
   SB_4_TEK=SB_14_TEK
ENDIF
;******************************
IF R0 == 2 ;GUD큦 Block 2
   DEUR=TEIL_2
   VERS=VERS_2
   DR=LAGE_2
   ANSCH=ANSCH_2
   HARDH=HARTHO_2
   GRAD=GRAD_2
   SKS=SKS_2
   STURING=STURING_2
   BRANDWEREND=BRANDWEREND_2
   SB_1_POS=SB_21_POS
   SB_1_PRG=SB_21_PRG
   SB_1_VNK=SB_21_VNK
   SB_1_TEK=SB_21_TEK
   SB_2_POS=SB_22_POS
   SB_2_PRG=SB_22_PRG
   SB_2_VNK=SB_22_VNK
   SB_2_TEK=SB_22_TEK
   SB_3_POS=SB_23_POS
   SB_3_PRG=SB_23_PRG
   SB_3_VNK=SB_23_VNK
   SB_3_TEK=SB_23_TEK
   SB_4_POS=SB_24_POS
   SB_4_PRG=SB_24_PRG
   SB_4_VNK=SB_24_VNK
   SB_4_TEK=SB_24_TEK
ENDIF
;******************************
IF R0 == 3 ;GUD큦 Block 3
   DEUR=TEIL_3
   VERS=VERS_3
   DR=LAGE_3
   ANSCH=ANSCH_3
   HARDH=HARTHO_3
   GRAD=GRAD_3
   SKS=SKS_3
   STURING=STURING_3
   BRANDWEREND=BRANDWEREND_3
   SB_1_POS=SB_31_POS
   SB_1_PRG=SB_31_PRG
   SB_1_VNK=SB_31_VNK
   SB_1_TEK=SB_31_TEK
   SB_2_POS=SB_32_POS
   SB_2_PRG=SB_32_PRG
   SB_2_VNK=SB_32_VNK
   SB_2_TEK=SB_32_TEK
   SB_3_POS=SB_33_POS
   SB_3_PRG=SB_33_PRG
   SB_3_VNK=SB_33_VNK
   SB_3_TEK=SB_33_TEK
   SB_4_POS=SB_34_POS
   SB_4_PRG=SB_34_PRG
   SB_4_VNK=SB_34_VNK
   SB_4_TEK=SB_34_TEK
ENDIF
;******************************
IF R0 == 4 ;GUD큦 Block 4
   DEUR=TEIL_4
   VERS=VERS_4
   DR=LAGE_4
   ANSCH=ANSCH_4
   HARDH=HARTHO_4
   GRAD=GRAD_4
   SKS=SKS_4
   STURING=STURING_4
   BRANDWEREND=BRANDWEREND_4
   SB_1_POS=SB_41_POS
   SB_1_PRG=SB_41_PRG
   SB_1_VNK=SB_41_VNK
   SB_1_TEK=SB_41_TEK
   SB_2_POS=SB_42_POS
   SB_2_PRG=SB_42_PRG
   SB_2_VNK=SB_42_VNK
   SB_2_TEK=SB_42_TEK
   SB_3_POS=SB_43_POS
   SB_3_PRG=SB_43_PRG
   SB_3_VNK=SB_43_VNK
   SB_3_TEK=SB_43_TEK
   SB_4_POS=SB_44_POS
   SB_4_PRG=SB_44_PRG
   SB_4_VNK=SB_44_VNK
   SB_4_TEK=SB_44_TEK
ENDIF
;******************************
IF R0 == 5 ;GUD큦 Block 5
   DEUR=TEIL_5
   VERS=VERS_5
   DR=LAGE_5
   ANSCH=ANSCH_5
   HARDH=HARTHO_5
   GRAD=GRAD_5
   SKS=SKS_5
   STURING=STURING_5
   BRANDWEREND=BRANDWEREND_5
   SB_1_POS=SB_51_POS
   SB_1_PRG=SB_51_PRG
   SB_1_VNK=SB_51_VNK
   SB_1_TEK=SB_51_TEK
   SB_2_POS=SB_52_POS
   SB_2_PRG=SB_52_PRG
   SB_2_VNK=SB_52_VNK
   SB_2_TEK=SB_52_TEK
   SB_3_POS=SB_53_POS
   SB_3_PRG=SB_53_PRG
   SB_3_VNK=SB_53_VNK
   SB_3_TEK=SB_53_TEK
   SB_4_POS=SB_54_POS
   SB_4_PRG=SB_54_PRG
   SB_4_VNK=SB_54_VNK
   SB_4_TEK=SB_54_TEK
ENDIF
;******************************
IF R0 == 6 ;GUD큦 Block 6
   DEUR=TEIL_6
   VERS=VERS_6
   DR=LAGE_6
   ANSCH=ANSCH_6
   HARDH=HARTHO_6
   GRAD=GRAD_6
   SKS=SKS_6
   STURING=STURING_6
   BRANDWEREND=BRANDWEREND_6
   SB_1_POS=SB_61_POS
   SB_1_PRG=SB_61_PRG
   SB_1_VNK=SB_61_VNK
   SB_1_TEK=SB_61_TEK
   SB_2_POS=SB_62_POS
   SB_2_PRG=SB_62_PRG
   SB_2_VNK=SB_62_VNK
   SB_2_TEK=SB_62_TEK
   SB_3_POS=SB_63_POS
   SB_3_PRG=SB_63_PRG
   SB_3_VNK=SB_63_VNK
   SB_3_TEK=SB_63_TEK
   SB_4_POS=SB_64_POS
   SB_4_PRG=SB_64_PRG
   SB_4_VNK=SB_64_VNK
   SB_4_TEK=SB_64_TEK
ENDIF
;******************************
IF R0 == 7 ;GUD큦 Block 7
   DEUR=TEIL_7
   VERS=VERS_7
   DR=LAGE_7
   ANSCH=ANSCH_7
   HARDH=HARTHO_7
   GRAD=GRAD_7
   SKS=SKS_7
   STURING=STURING_7
   BRANDWEREND=BRANDWEREND_7
   SB_1_POS=SB_71_POS
   SB_1_PRG=SB_71_PRG
   SB_1_VNK=SB_71_VNK
   SB_1_TEK=SB_71_TEK
   SB_2_POS=SB_72_POS
   SB_2_PRG=SB_72_PRG
   SB_2_VNK=SB_72_VNK
   SB_2_TEK=SB_72_TEK
   SB_3_POS=SB_73_POS
   SB_3_PRG=SB_73_PRG
   SB_3_VNK=SB_73_VNK
   SB_3_TEK=SB_73_TEK
   SB_4_POS=SB_74_POS
   SB_4_PRG=SB_74_PRG
   SB_4_VNK=SB_74_VNK
   SB_4_TEK=SB_74_TEK
ENDIF
;******************************
IF R0 == 8 ;GUD큦 Block 8
   DEUR=TEIL_8
   VERS=VERS_8
   DR=LAGE_8
   ANSCH=ANSCH_8
   HARDH=HARTHO_8
   GRAD=GRAD_8
   SKS=SKS_8
   STURING=STURING_8
   BRANDWEREND=BRANDWEREND_8
   SB_1_POS=SB_81_POS
   SB_1_PRG=SB_81_PRG
   SB_1_VNK=SB_81_VNK
   SB_1_TEK=SB_81_TEK
   SB_2_POS=SB_82_POS
   SB_2_PRG=SB_82_PRG
   SB_2_VNK=SB_82_VNK
   SB_2_TEK=SB_82_TEK
   SB_3_POS=SB_83_POS
   SB_3_PRG=SB_83_PRG
   SB_3_VNK=SB_83_VNK
   SB_3_TEK=SB_83_TEK
   SB_4_POS=SB_84_POS
   SB_4_PRG=SB_84_PRG
   SB_4_VNK=SB_84_VNK
   SB_4_TEK=SB_84_TEK
ENDIF
;******************************
IF R0 == 9 ;GUD큦 Block 9
   DEUR=TEIL_9
   VERS=VERS_9
   DR=LAGE_9
   ANSCH=ANSCH_9
   HARDH=HARTHO_9
   GRAD=GRAD_9
   SKS=SKS_9
   STURING=STURING_9
   BRANDWEREND=BRANDWEREND_9
   SB_1_POS=SB_91_POS
   SB_1_PRG=SB_91_PRG
   SB_1_VNK=SB_91_VNK
   SB_1_TEK=SB_91_TEK
   SB_2_POS=SB_92_POS
   SB_2_PRG=SB_92_PRG
   SB_2_VNK=SB_92_VNK
   SB_2_TEK=SB_92_TEK
   SB_3_POS=SB_93_POS
   SB_3_PRG=SB_93_PRG
   SB_3_VNK=SB_93_VNK
   SB_3_TEK=SB_93_TEK
   SB_4_POS=SB_94_POS
   SB_4_PRG=SB_94_PRG
   SB_4_VNK=SB_94_VNK
   SB_4_TEK=SB_94_TEK
ENDIF

;---------------------Hoofdprogramma voor Kanal 7-----------------
R1 = 7 ;Kanaalnummer

CORR_AANSLAG900 = 0

IF DR == "1"
   R2 = 0
   IF SB_1_POS <= AANSLAG900_L
      CORR_AANSLAG900 = A_DIFF_S1 + 0 ; 117.0
   ENDIF
ENDIF
IF DR == "2"
   R2 = 1
   IF SB_1_POS >= AANSLAG900_R
      CORR_AANSLAG900 = A_DIFF_S1 + 1 ; 117.0
   ENDIF
ENDIF
IF HARDH == "YES"
   R4 = 1
  ELSE
   R4 = 0
ENDIF
IF SKS < 10   ; R6, 2-stufig Kanal 6,7
   R6 = 0
  ELSE
   R6 = 1
ENDIF

AANTAL = 0
IF SB_1_POS > 0
   AANTAL = AANTAL + 1
ENDIF
IF SB_2_POS > 0
   AANTAL = AANTAL + 1
ENDIF
IF SB_3_POS > 0
   AANTAL = AANTAL + 1
ENDIF
IF SB_4_POS > 0
   AANTAL = AANTAL + 1
ENDIF

R5 = AANTAL

G00

IF (AANTAL == 0) OR (KANAAL7_DISABLED == 1)
   M53
   G4 F1  ; Geen bewerking
  ELSE
   IF DR == "1"
      IF SB_1_POS > 0
         IF SB_1_PRG == "DB"
            IF (SUBSTR(SB_1_VNK,0,1) == "0") OR (SUBSTR(SB_1_VNK,1,1) == "0")
               STOPRE
               TRANS X=(SB_1_POS + CORR_AANSLAG900 + X_CORR_L) ;Z=SKS
               DBK67(SB_1_TEK, ARRAYKRSL, ARRAYVG)
               STOPRE
               KAN7LS1(ARRAYKRSL, ARRAYVG, SB_1_VNK)
              ELSE
               M53
               G4 F1  ; Geen bewerking
            ENDIF
           ELSE
            STOPRE
            TRANS X=(SB_1_POS + CORR_AANSLAG900 + X_CORR_L) ;Z=SKS
            STOPRE
            _WACHT14 = 1
            call "/_N_SPF_DIR/_N_"<<SB_1_PRG<<"_SPF"
         ENDIF
      ENDIF
      IF SB_2_POS > 0
         IF SB_2_PRG == "DB"
            IF (SUBSTR(SB_2_VNK,0,1) == "0") OR (SUBSTR(SB_2_VNK,1,1) == "0")
               TRANS X=(SB_2_POS + CORR_AANSLAG900 + X_CORR_L) ;Z=SKS
               DBK67(SB_2_TEK, ARRAYKRSL, ARRAYVG)
               KAN7LS1(ARRAYKRSL, ARRAYVG, SB_2_VNK)
              ELSE
               M53
               G4 F1  ; Geen bewerking
            ENDIF
           ELSE
            STOPRE
            TRANS X=(SB_2_POS + CORR_AANSLAG900 + X_CORR_L) ;Z=SKS
            STOPRE
            _WACHT14 = 2
            call "/_N_SPF_DIR/_N_"<<SB_2_PRG<<"_SPF"
         ENDIF
      ENDIF
      IF SB_3_POS > 0
         IF SB_3_PRG == "DB"
            IF (SUBSTR(SB_3_VNK,0,1) == "0") OR (SUBSTR(SB_3_VNK,1,1) == "0")
               TRANS X=(SB_3_POS + CORR_AANSLAG900 + X_CORR_L) ;Z=SKS
               DBK67(SB_3_TEK, ARRAYKRSL, ARRAYVG)
               KAN7LS1(ARRAYKRSL, ARRAYVG, SB_3_VNK)
              ELSE
               M53
               G4 F1  ; Geen bewerking
            ENDIF
           ELSE
            STOPRE
            TRANS X=(SB_3_POS + CORR_AANSLAG900 + X_CORR_L) ;Z=SKS
            STOPRE
            _WACHT14 = 3
            call "/_N_SPF_DIR/_N_"<<SB_3_PRG<<"_SPF"
         ENDIF
      ENDIF
      IF SB_4_POS > 0
         IF SB_4_PRG == "DB"
            IF (SUBSTR(SB_4_VNK,0,1) == "0") OR (SUBSTR(SB_4_VNK,1,1) == "0")
               TRANS X=(SB_4_POS + CORR_AANSLAG900 + X_CORR_L) ;Z=SKS
               DBK67(SB_4_TEK, ARRAYKRSL, ARRAYVG)
               KAN7LS1(ARRAYKRSL, ARRAYVG, SB_4_VNK)
              ELSE
               M53
               G4 F1  ; Geen bewerking
            ENDIF
           ELSE
            STOPRE
            TRANS X=(SB_4_POS + CORR_AANSLAG900 + X_CORR_L) ;Z=SKS
            STOPRE
            _WACHT14 = 4
            call "/_N_SPF_DIR/_N_"<<SB_4_PRG<<"_SPF"
         ENDIF
      ENDIF
   ENDIF
   IF DR == "2"
      IF SB_1_POS > 0
         IF SB_1_PRG == "DB"
            IF (SUBSTR(SB_1_VNK,0,1) == "0") OR (SUBSTR(SB_1_VNK,1,1) == "0")
               STOPRE
               TRANS X=(SB_1_POS + X_CORR_R - CORR_AANSLAG900) ;Z=SKS
               DBK67(SB_1_TEK, ARRAYKRSL, ARRAYVG)
               STOPRE
               KAN7RS1(ARRAYKRSL, ARRAYVG, SB_1_VNK)
              ELSE
               M53
               G04 F1  ; Geen bewerking
            ENDIF
           ELSE
            STOPRE
            TRANS X=(SB_1_POS + X_CORR_R - CORR_AANSLAG900) ;Z=SKS
            STOPRE
            _WACHT14 = 1
            call "/_N_SPF_DIR/_N_"<<SB_1_PRG<<"_SPF"
         ENDIF
      ENDIF
      IF SB_2_POS > 0
         IF SB_2_PRG == "DB"
            IF (SUBSTR(SB_2_VNK,0,1) == "0" OR SUBSTR(SB_2_VNK,1,1) == "0")
               TRANS X=(SB_2_POS + KORA2_S1 - CORR_AANSLAG900 + X_CORR_R) ;Z=SKS
               DBK67(SB_2_TEK, ARRAYKRSL, ARRAYVG)
               KAN7RS1(ARRAYKRSL, ARRAYVG, SB_2_VNK)
              ELSE
               M53
               G04 F1  ; Geen bewerking
            ENDIF
           ELSE
            STOPRE
            TRANS X=(SB_2_POS + KORA2_S1 - CORR_AANSLAG900 + X_CORR_R) ;Z=SKS
            STOPRE
            _WACHT14 = 2
            call "/_N_SPF_DIR/_N_"<<SB_2_PRG<<"_SPF"
         ENDIF
      ENDIF
      IF SB_3_POS > 0
         IF SB_3_PRG == "DB"
            IF (SUBSTR(SB_3_VNK,0,1) == "0") OR (SUBSTR(SB_3_VNK,1,1) == "0")
               TRANS X=(SB_3_POS + KORA2_S1 - CORR_AANSLAG900 + X_CORR_R) ;Z=SKS
               DBK67(SB_3_TEK, ARRAYKRSL, ARRAYVG)
               KAN7RS1(ARRAYKRSL, ARRAYVG, SB_3_VNK)
              ELSE
               M53
               G04 F1  ; Geen bewerking
            ENDIF
           ELSE
            STOPRE
            TRANS X=(SB_3_POS + KORA2_S1 - CORR_AANSLAG900 + X_CORR_R) ;Z=SKS
            STOPRE
            _WACHT14 = 3
            call "/_N_SPF_DIR/_N_"<<SB_3_PRG<<"_SPF"
         ENDIF
      ENDIF
      IF SB_4_POS > 0
         IF SB_4_PRG == "DB"
            IF (SUBSTR(SB_4_VNK,0,1) == "0") OR (SUBSTR(SB_4_VNK,1,1) == "0")
               TRANS X=(SB_4_POS + KORA2_S1 - CORR_AANSLAG900 + X_CORR_R) ;Z=SKS
               DBK67(SB_4_TEK, ARRAYKRSL, ARRAYVG)
               KAN7RS1(ARRAYKRSL, ARRAYVG, SB_4_VNK)
              ELSE
               M53
               G04 F1  ; Geen bewerking
            ENDIF
           ELSE
            STOPRE
            TRANS X=(SB_4_POS + KORA2_S1 - CORR_AANSLAG900 + X_CORR_R) ;Z=SKS
            STOPRE
            _WACHT14 = 4
            call "/_N_SPF_DIR/_N_"<<SB_4_PRG<<"_SPF"
         ENDIF
      ENDIF
   ENDIF
ENDIF
STOPRE
M99
STOPRE
KANAAL7_FINISHED = 1
KANAALOVERSLAAN:

IF (AANTAL > 0) AND (_WACHT1 == 111)

ENDIF
STOPRE

M54
STOPRE
KANAAL7_FINISHED = 0
STOPRE

M30 ;------Programmaeinde-----
